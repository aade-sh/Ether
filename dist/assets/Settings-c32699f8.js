var K=Object.defineProperty;var D=(r,e,t)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>(D(r,typeof e!="symbol"?e+"":e,t),t);import{Z as $,D as f,T as A,s as k,a as L,r as w,b,c as x,d as T,L as R,e as G,g as U,f as H,h as P,i as M,j as J,k as q,l as _,C as S,S as p,m as W,n as Y}from"./index-295259eb.js";class E{constructor({wrapperEl:e,updateState:t,getState:n,id:s}){u(this,"wrapperEl");u(this,"updateState");u(this,"getState");u(this,"id");this.wrapperEl=e,this.updateState=t.bind(this),this.getState=n,this.id=s}render(){const e=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),n=Object.entries(e);for(let s=0;s<n.length&&!(!t[s]||!n[s]);s++){const i=t[s].querySelector("label"),a=t[s].querySelector("input"),[o,c]=n[s],l=`${this.id}-${o.replace(" ","-")}`;i.textContent=o,i.setAttribute("for",l),a.id=l,a.name=o,a.value=c,a.addEventListener("input",this.updateState)}}rerender(){const e=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),n=Object.entries(e);for(let s=0;s<n.length&&!(!t[s]||!n[s]);s++){const i=t[s].querySelector("input"),[,a]=n[s];i.value=a}}}function O(r){return r&&typeof r=="object"&&r.constructor===Object}function j(r){return Array.isArray(r)&&r.every(e=>O(e))}function y(r){for(const e of Object.keys(r))typeof r[e]=="string"?r[e]=r[e].trim():O(r[e])?y(r[e]):j(r[e])&&r[e].forEach(t=>y(t))}class C{constructor({title:e,state:t,sectionEl:n,onSave:s,render:i,rerender:a}){u(this,"title");u(this,"state");u(this,"_defaultState");u(this,"sectionEl");u(this,"onSave");u(this,"render");u(this,"rerender");this.title=e,this.state=t,this._defaultState=JSON.parse(JSON.stringify(t)),this.sectionEl=n,this.onSave=s,this.rerender=a,this.render=i}save(){try{this.state&&O(this.state)?y(this.state):typeof this.state=="string"?this.state=this.state.trim():j(this.state)&&this.state.forEach(e=>y(e)),this.onSave(this.state),this._defaultState=this.state,this.displaySuccessMsg(),this.sectionEl.classList.remove("error"),this.rerender()}catch(e){const t=e;if(e instanceof $){let n="";e.issues.forEach(s=>n+=`
${s.message}`),this.displayFailedMsg(n)}else t.message==="The quota has been exceeded."?this.displayFailedMsg("The image is too large."):this.displayFailedMsg(t.message||void 0);this.sectionEl.classList.add("error")}}displayFailedMsg(e){const t=this.sectionEl.querySelector(".msg");e=e||"failed, localStorage is turned off or full",f.displayMsg(t,e)}hideMsg(){this.sectionEl.querySelector(".msg").classList.add("hide")}displaySuccessMsg(){const e=this.sectionEl.querySelector(".msg");f.displayMsg(e,`successfully saved your ${this.title}`),setTimeout(()=>{e.classList.add("hide")},3e3)}reset(){this.state=JSON.parse(JSON.stringify(this._defaultState)),this.sectionEl.querySelector(".msg").classList.add("hide"),this.sectionEl.classList.remove("error")}}class g extends C{constructor({title:t,state:n,sectionEl:s,children:i=[],onSave:a}){super({title:t,state:n,sectionEl:s,onSave:a,render:()=>{},rerender:()=>{}});u(this,"title");u(this,"state");u(this,"_defaultState");u(this,"sectionEl");u(this,"children");u(this,"onSave");this.title=t,this.state=n,this._defaultState=JSON.parse(JSON.stringify(n)),this.sectionEl=s,this.children=i,this.onSave=a,this.render=function(){var c;this.children.forEach(l=>{Array.isArray(this.state),l.render()}),(c=this.sectionEl.querySelector("button[type='submit']"))==null||c.addEventListener("click",l=>{l.preventDefault(),this.save()});const o=this.sectionEl.querySelector("button[aria-label='reset']");o==null||o.addEventListener("click",()=>{this.reset(),this.rerender()})},this.rerender=function(){this.children.forEach(o=>{Array.isArray(this.state),o.rerender()})}}}function Z(r,e){const t=new g({title:"theme",state:r,sectionEl:document.getElementById("theme-settings"),children:[{render:function(){const n=document.querySelector("#theme-settings select");n.value="custom";for(const s of Object.keys(A)){const i=f.option({text:s,value:s});n.append(i),n.addEventListener("change",()=>{const a=A[n.value];k(a.theme),L(a.image),w(),b(),t.state=a.theme,e.state=a.image,t.rerender(),e.rerender()})}},rerender:()=>{}},new E({wrapperEl:document.querySelector("#theme-settings .input-group"),updateState:n=>{const s=document.querySelector("#theme-settings select");s.value="custom";const i=n.target,a=i.name;a==="panel opacity"?t.state[a]=Number(i.value):t.state[a]=i.value},getState:()=>t.state,id:"theme"})],onSave:()=>{k(t.state),b()}});return t}class z{constructor({wrapperEl:e,updateLink:t,updateTitle:n,getState:s,id:i}){u(this,"wrapperEl");u(this,"updateTitle");u(this,"updateLink");u(this,"children");u(this,"getState");u(this,"id");this.wrapperEl=e,this.updateLink=t,this.updateTitle=n,this.getState=s,this.id=i;const a=this.wrapperEl.querySelectorAll(".link-details");this.children=Array.from(a).map((o,c)=>new E({wrapperEl:o,updateState:l=>{t(l,c)},getState:()=>s().links[c],id:this.id+"-"+c.toString()}))}render(){const e=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=e.title,t.addEventListener("input",o=>{this.updateTitle(o),this.rerender()});const n=this.wrapperEl.querySelector("header span.link-group-title");n.textContent=e.title;const s=this.wrapperEl.querySelector("header .edit-button"),i=o=>{var c,l;o.stopPropagation(),(c=this.wrapperEl.querySelector(".display-mode"))==null||c.classList.toggle("hide"),(l=this.wrapperEl.querySelector(".edit-mode"))==null||l.classList.toggle("hide")};s==null||s.addEventListener("click",i);const a=this.wrapperEl.querySelector("header .done-button");a==null||a.addEventListener("click",o=>{i(o)}),this.children.forEach(o=>o.render())}rerender(){const e=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=e.title;const n=this.wrapperEl.querySelector("header span.link-group-title");n.textContent=e.title,this.children.forEach(s=>s.rerender())}}function I(r,e,t=document){let n=t.querySelectorAll(e);if(n.length!==r)for(;n.length!=r;){let s;n.length>r?s=n[n.length-1].remove:s=()=>{var i;(i=n[0].parentElement)==null||i.append(n[0].cloneNode(!0))},s(),n=t.querySelectorAll(e)}}function Q(r){I(R,"form[name='links'] > ul .link-group"),document.querySelectorAll("form[name='links'] > ul .link-group").forEach(n=>I(G,".link-details",n)),document.querySelectorAll("form[name='links'] > ul .link-group > header").forEach(n=>n.addEventListener("click",function(i){const o=i.currentTarget.nextElementSibling,c=n.querySelector(".display-mode");c!=null&&c.classList.contains("hide")||(o.classList.toggle("accordion"),n.classList.toggle("accordion-closed"))}));const t=new g({title:"links",state:r,sectionEl:document.getElementById("link-settings"),children:[...Array.from(document.querySelectorAll("#link-settings .link-group")).map((n,s)=>new z({wrapperEl:n,updateLink:(i,a)=>{const o=i.target;t.state[s].links[a][o.name]=o.value},updateTitle:i=>{const a=i.target;r[s].title=a.value},getState:()=>t.state[s],id:"group-"+s.toString()}))],onSave:()=>{x(t.state),T()}});return t}function V(r){const e=new g({title:"keybinds",state:r,sectionEl:document.getElementById("keybind-settings"),children:[{render:function(){var s;const t=document.getElementById("keybind-settings"),n=t.querySelector("#keybind-settings textarea");n.value=JSON.stringify(r,null,2),n.addEventListener("input",i=>{const a=i.target;try{e.state=JSON.parse(a.value),e.hideMsg(),e.sectionEl.classList.remove("error")}catch{e.sectionEl.classList.add("error"),e.displayFailedMsg("Invalid json")}}),(s=t.querySelector("button[data-role='generate keybinds']"))==null||s.addEventListener("click",()=>{const i=U();if(!i)return;const a=H(i,P());e.state=a,this.rerender()})},rerender:()=>{const t=document.querySelector("#keybind-settings textarea");t.value=JSON.stringify(e.state,null,2)}}],onSave:()=>{M(e.state),J()}});return e}function X(r){const e=new g({title:"image",state:r,sectionEl:document.getElementById("image-settings"),children:[function(){return{render:function(){const n=document.getElementById("image-settings");n.querySelector("input[type='file']").addEventListener("change",i=>{const a=i.target;if(!a.files)return;const o=a.files[0];function c(){const d=o.name.match(/\.[0-9a-z]+$/i);return d&&[".jpg",".png",".webp",".gif",".svg"].includes(d[0])}try{if(!c())throw new Error("Not a valid image")}catch(d){const m=d;e.displayFailedMsg(m.message)}const l=new FileReader;l.addEventListener("load",()=>{const d=n.querySelector("label .button-text");d.textContent=o.name,e.state.image=`url(${l.result})`}),l.readAsDataURL(o)})},rerender:function(){const s=document.getElementById("image-settings").querySelector("label .button-text");s.textContent="Choose your image"}}}(),new E({wrapperEl:document.querySelector("#image-settings .input-group"),updateState:t=>{const n=t.target,s=n.name;s!=="image"&&(e.state[s]=n.value)},getState:()=>{const t={...e.state};return delete t.image,t},id:"a"})],onSave:t=>{L(t),w()}});return e}function ee(){const r=new C({title:"json",sectionEl:document.querySelector("#json-settings"),state:"",render:function(){var s;const e=document.querySelector("#json-settings"),t=e==null?void 0:e.querySelector("form[name='import json'] textarea");t.value=this.state,t==null||t.addEventListener("input",i=>{const a=i.target;this.state=a.value}),(s=this.sectionEl.querySelector("button[type='submit']"))==null||s.addEventListener("click",i=>{i.preventDefault(),this.save()});const n=this.sectionEl.querySelector("button[aria-label='reset']");n==null||n.addEventListener("click",()=>{this.reset(),this.rerender()})},rerender:function(){const e=document.querySelector("#json-settings"),t=e==null?void 0:e.querySelector("form[name='import json'] textarea");t.value=r.state},onSave:function(){const e=this.state.replace(/[\n\r]+/g,""),t=JSON.parse(e);for(const[n,s]of Object.entries(t))switch(n){case"theme":{k(s),b();break}case"links":{x(s),T();break}case"image":{L(s),w();break}case"keybinds":{M(s),J();break}case"search":{q(s),_();break}default:throw new Error(`${n} is an invalid option`)}}});return r}function te(r,e){function t(){var i;(i=document.getElementById("custom-search-settings"))==null||i.classList.remove("inactive")}function n(){var i;(i=document.getElementById("custom-search-settings"))==null||i.classList.add("inactive")}const s=new g({title:"search",state:{search:r,[S]:e},sectionEl:document.getElementById("search-settings"),children:[function(){return{sectionEl:document.getElementById("search-settings-select-wrapper"),render:function(){var c;s.state[p]==="custom"?t():n();const a=(c=s.sectionEl)==null?void 0:c.querySelector("select[name='search-engine']");a.addEventListener("change",l=>{const d=l.target;s.state.search=d.value,d.value==="custom"?t():n()}),a.querySelectorAll("option").forEach(l=>{l.value===s.state.search&&l.setAttribute("selected","true")})},rerender:function(){var c;s.state[p]==="custom"?t():n(),((c=s.sectionEl)==null?void 0:c.querySelector("select[name='search-engine']")).querySelectorAll("option").forEach(l=>{l.value===s.state.search&&l.setAttribute("selected","true")})}}}(),function(){var a;return new E({wrapperEl:(a=document.getElementById("custom-search-settings"))==null?void 0:a.querySelector(".input-group"),getState:function(){return s.state[S]},id:"custom-search",updateState:function(o){let c=o.target,l=c.name;s.state[S][l]=c.value}})}()],onSave:function(){this.state.search==="custom"?(W(this.state[S]),q(this.state[p])):q(this.state[p]),_()}});return s}const se={getAll:function(){const r=JSON.parse(JSON.stringify(localStorage));for(const e of Object.keys(r))r[e]=JSON.parse(r[e]);return r},format:function(){return JSON.stringify(this.getAll(),null,2)}},h=document.getElementById("confirm-modal");h.addEventListener("click",B);var N;(N=h.querySelector(".content"))==null||N.addEventListener("click",r=>r.stopPropagation());function ne(){h.showModal()}function B(){h.close()}const re=h.querySelector("button[aria-label='confirm']"),v=h.querySelector("button[aria-label='cancel']");v==null||v.addEventListener("click",B);function ie(){return{render:()=>{const r=document.getElementById("link-buttons-container"),e=r==null?void 0:r.querySelector("a[data-role='reset to defaults']");e==null||e.addEventListener("click",n=>{n.preventDefault(),ne()}),re.onclick=()=>{localStorage.clear(),location.reload()};const t=r==null?void 0:r.querySelector("a[data-role='copy config']");t==null||t.addEventListener("click",n=>{var i;n.preventDefault(),navigator.clipboard.writeText(se.format());const s=(i=t==null?void 0:t.parentElement)==null?void 0:i.querySelector(".msg");f.displayMsg(s,"your config has been copied to your clipboard"),setTimeout(()=>{s.classList.add("hide")},3e3)})}}}function le({links:r,theme:e,keybinds:t,imageState:n,search:s}){const i=Q(r),a=V(t),o=X(n),c=Z(e,o),l=te(s,Y()||{name:"","query url":""}),d=ee(),m=ie();[c,i,a,o,l,d,m].forEach(F=>F.render())}export{le as default};
