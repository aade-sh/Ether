import{Z as H,D as S,T as f,s as T,a as q,r as k,b as O,g as _,c as M,d as w,L as I,e as N,f as C,h as P,i as W,K as A,j as K,k as j,l as D,m as Z,n as F,I as E,C as d,o as J,p as L,S as h,q as b,t as Y,u as z}from"./index.astro_astro_type_script_index_0_lang.DAmB8SOF.js";class v{wrapperEl;updateState;getState;id;constructor({wrapperEl:s,updateState:t,getState:n,id:e}){this.wrapperEl=s,this.updateState=t.bind(this),this.getState=n,this.id=e}render(){const s=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),n=Object.entries(s);for(let e=0;e<n.length&&!(!t[e]||!n[e]);e++){const a=t[e].querySelector("label"),i=t[e].querySelector("input"),[o,c]=n[e],l=`${this.id}-${o.replace(" ","-")}`;a.textContent=o,a.setAttribute("for",l),i.id=l,i.name=o,i.value=c,i.addEventListener("input",this.updateState)}}rerender(){const s=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),n=Object.entries(s);for(let e=0;e<n.length&&!(!t[e]||!n[e]);e++){const a=t[e].querySelector("input"),[,i]=n[e];a.value=i}}}function B(r){return r&&typeof r=="object"&&r.constructor===Object}function $(r){return Array.isArray(r)&&r.every(s=>B(s))}function y(r){for(const s of Object.keys(r))typeof r[s]=="string"?r[s]=r[s].trim():B(r[s])?y(r[s]):$(r[s])&&r[s].forEach(t=>y(t))}class G{title;state;_defaultState;sectionEl;onSave;render;rerender;constructor({title:s,state:t,sectionEl:n,onSave:e,render:a,rerender:i}){this.title=s,this.state=t,this._defaultState=JSON.parse(JSON.stringify(t)),this.sectionEl=n,this.onSave=e,this.rerender=i,this.render=a}save(){try{this.state&&B(this.state)?y(this.state):typeof this.state=="string"?this.state=this.state.trim():$(this.state)&&this.state.forEach(s=>y(s)),this.onSave(this.state),this._defaultState=this.state,this.displaySuccessMsg(),this.sectionEl.classList.remove("error"),this.rerender()}catch(s){const t=s;if(s instanceof H){let n="";s.issues.forEach(e=>n+=`
${e.message}`),this.displayFailedMsg(n)}else t.message==="The quota has been exceeded."?this.displayFailedMsg("The image is too large."):this.displayFailedMsg(t.message||void 0);this.sectionEl.classList.add("error")}}displayFailedMsg(s){const t=this.sectionEl.querySelector(".msg");s=s||"failed, localStorage is turned off or full",S.displayMsg(t,s)}hideMsg(){this.sectionEl.querySelector(".msg").classList.add("hide")}displaySuccessMsg(){const s=this.sectionEl.querySelector(".msg");S.displayMsg(s,`successfully saved your ${this.title}`),setTimeout(()=>{s.classList.add("hide")},3e3)}reset(){this.state=JSON.parse(JSON.stringify(this._defaultState)),this.sectionEl.querySelector(".msg").classList.add("hide"),this.sectionEl.classList.remove("error")}}class p extends G{title;state;_defaultState;sectionEl;children;onSave;constructor({title:s,state:t,sectionEl:n,children:e=[],onSave:a}){super({title:s,state:t,sectionEl:n,onSave:a,render:()=>{},rerender:()=>{}}),this.title=s,this.state=t,this._defaultState=JSON.parse(JSON.stringify(t)),this.sectionEl=n,this.children=e,this.onSave=a,this.render=function(){this.children.forEach(o=>{Array.isArray(this.state),o.render()}),this.sectionEl.querySelector("button[type='submit']")?.addEventListener("click",o=>{o.preventDefault(),this.save()}),this.sectionEl.querySelector("button[aria-label='reset']")?.addEventListener("click",()=>{this.reset(),this.rerender()})},this.rerender=function(){this.children.forEach(i=>{Array.isArray(this.state),i.rerender()})}}}function Q(r,s){const t=new p({title:f,state:r,sectionEl:document.getElementById("theme-settings"),children:[{render:function(){const n=document.querySelector("#theme-settings select");n.value="custom";for(const e of Object.keys(O)){const a=S.option({text:e,value:e});n.append(a),n.addEventListener("change",()=>{const i=n.value==="custom"?{theme:M(),image:_()}:O[n.value];k(i.theme),w(i.image),t.state=i.theme,s.state=i.image,t.rerender(),s.rerender()})}},rerender:()=>{}},new v({wrapperEl:document.querySelector("#theme-settings .input-group"),updateState:n=>{const e=document.querySelector("#theme-settings select");e.value="custom";const a=n.target,i=a.name;i==="panel opacity"?t.state[i]=Number(a.value):t.state[i]=a.value},getState:()=>t.state,id:f})],onSave:()=>{T(t.state),q(s.state),k(t.state)}});return t}class V{wrapperEl;updateTitle;updateLink;children;getState;id;constructor({wrapperEl:s,updateLink:t,updateTitle:n,getState:e,id:a}){this.wrapperEl=s,this.updateLink=t,this.updateTitle=n,this.getState=e,this.id=a;const i=this.wrapperEl.querySelectorAll(".link-details");this.children=Array.from(i).map((o,c)=>new v({wrapperEl:o,updateState:l=>{t(l,c)},getState:()=>e().links[c],id:this.id+"-"+c.toString()}))}render(){const s=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=s.title,t.addEventListener("input",o=>{this.updateTitle(o),this.rerender()});const n=this.wrapperEl.querySelector("header span.link-group-title");n.textContent=s.title;const e=this.wrapperEl.querySelector("header .edit-button"),a=o=>{o.stopPropagation(),this.wrapperEl.querySelector(".display-mode")?.classList.toggle("hide"),this.wrapperEl.querySelector(".edit-mode")?.classList.toggle("hide")};e?.addEventListener("click",a),this.wrapperEl.querySelector("header .done-button")?.addEventListener("click",o=>{a(o)}),this.children.forEach(o=>o.render())}rerender(){const s=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=s.title;const n=this.wrapperEl.querySelector("header span.link-group-title");n.textContent=s.title,this.children.forEach(e=>e.rerender())}}function x(r,s,t=document){let n=t.querySelectorAll(s);if(n.length!==r)for(;n.length!=r;){let e;n.length>r?e=n[n.length-1].remove:e=()=>{n[0].parentElement?.append(n[0].cloneNode(!0))},e(),n=t.querySelectorAll(s)}}function X(r){x(P,"form[name='links'] > ul .link-group"),document.querySelectorAll("form[name='links'] > ul .link-group").forEach(n=>x(W,".link-details",n)),document.querySelectorAll("form[name='links'] > ul .link-group > header").forEach(n=>n.addEventListener("click",function(a){const o=a.currentTarget.nextElementSibling;n.querySelector(".display-mode")?.classList.contains("hide")||(o.classList.toggle("accordion"),n.classList.toggle("accordion-closed"))}));const t=new p({title:I,state:r,sectionEl:document.getElementById("link-settings"),children:[...Array.from(document.querySelectorAll("#link-settings .link-group")).map((n,e)=>new V({wrapperEl:n,updateLink:(a,i)=>{const o=a.target;t.state[e].links[i][o.name]=o.value},updateTitle:a=>{const i=a.target;r[e].title=i.value},getState:()=>t.state[e],id:"group-"+e.toString()}))],onSave:()=>{N(t.state),C()}});return t}function ee(r){const s=new p({title:A,state:r,sectionEl:document.getElementById("keybind-settings"),children:[{render:function(){const t=document.getElementById("keybind-settings"),n=t.querySelector("#keybind-settings textarea");n.value=JSON.stringify(r,null,2),n.addEventListener("input",e=>{const a=e.target;try{s.state=JSON.parse(a.value),s.hideMsg(),s.sectionEl.classList.remove("error")}catch{s.sectionEl.classList.add("error"),s.displayFailedMsg("Invalid json")}}),t.querySelector("button[data-role='generate keybinds']")?.addEventListener("click",()=>{const e=D();if(!e)return;const a=Z(e,F());s.state=a,this.rerender()})},rerender:()=>{const t=document.querySelector("#keybind-settings textarea");t.value=JSON.stringify(s.state,null,2)}}],onSave:()=>{K(s.state),j()}});return s}function te(r){const s=new p({title:E,state:r,sectionEl:document.getElementById("image-settings"),children:[function(){return{render:function(){const n=document.getElementById("image-settings");n.querySelector("input[type='file']").addEventListener("change",a=>{const i=a.target;if(!i.files)return;const o=i.files[0];function c(){const u=o.name.match(/\.[0-9a-z]+$/i);return u&&[".jpg",".png",".webp",".gif",".svg"].includes(u[0])}try{if(!c())throw new Error("Not a valid image")}catch(u){const m=u;s.displayFailedMsg(m.message)}const l=new FileReader;l.addEventListener("load",()=>{const u=n.querySelector("label .button-text");u.textContent=o.name,s.state.image=`url(${l.result})`}),l.readAsDataURL(o)})},rerender:function(){const e=document.getElementById("image-settings").querySelector("label .button-text");e.textContent="Choose your image"}}}(),new v({wrapperEl:document.querySelector("#image-settings .input-group"),updateState:t=>{const n=t.target,e=n.name;e!==E&&(s.state[e]=n.value)},getState:()=>{const t={...s.state};return delete t.image,t},id:"a"})],onSave:t=>{q(t),w(t)}});return s}function se(){const r=new G({title:"json",sectionEl:document.querySelector("#json-settings"),state:"",render:function(){const t=document.querySelector("#json-settings")?.querySelector("form[name='import json'] textarea");t.value=this.state,t?.addEventListener("input",e=>{const a=e.target;this.state=a.value}),this.sectionEl.querySelector("button[type='submit']")?.addEventListener("click",e=>{e.preventDefault(),this.save()}),this.sectionEl.querySelector("button[aria-label='reset']")?.addEventListener("click",()=>{this.reset(),this.rerender()})},rerender:function(){const t=document.querySelector("#json-settings")?.querySelector("form[name='import json'] textarea");t.value=r.state},onSave:function(){const s=this.state.replace(/[\n\r]+/g,""),t=JSON.parse(s);for(const[n,e]of Object.entries(t))switch(n){case f:{T(e),k(e);break}case I:{N(e),C();break}case E:{q(e),w(e);break}case A:{K(e),j();break}case h:{b(e),L();break}case d:{J(e),L();break}default:throw new Error(`${n} is an invalid option`)}}});return r}function ne(r,s){function t(){document.getElementById("custom-search-settings")?.classList.remove("inactive")}function n(){document.getElementById("custom-search-settings")?.classList.add("inactive")}const e=new p({title:"search",state:{search:r,[d]:s},sectionEl:document.getElementById("search-settings"),children:[function(){return{sectionEl:document.getElementById("search-settings-select-wrapper"),render:function(){e.state[h]==="custom"?t():n();const i=e.sectionEl?.querySelector("select[name='search-engine']");i.addEventListener("change",c=>{const l=c.target;e.state.search=l.value,l.value==="custom"?t():n()}),i.querySelectorAll("option").forEach(c=>{c.value===e.state.search&&c.setAttribute("selected","true")})},rerender:function(){e.state[h]==="custom"?t():n(),(e.sectionEl?.querySelector("select[name='search-engine']")).querySelectorAll("option").forEach(c=>{c.value===e.state.search&&c.setAttribute("selected","true")})}}}(),function(){return new v({wrapperEl:document.getElementById("custom-search-settings")?.querySelector(".input-group"),getState:function(){return e.state[d]},id:"custom-search",updateState:function(i){let o=i.target,c=o.name;e.state[d][c]=o.value}})}()],onSave:function(){this.state.search==="custom"?(J(this.state[d]),b(this.state[h])):b(this.state[h]),L()}});return e}const re={getAll:function(){return{[f]:M(),[I]:D(),[A]:F(),[E]:_(),[h]:z(),[d]:Y()}},format:function(){return JSON.stringify(this.getAll(),null,2)}},g=document.getElementById("confirm-modal");g.addEventListener("click",R);g.querySelector(".content")?.addEventListener("click",r=>r.stopPropagation());function ie(){g.showModal()}function R(){g.close()}const ae=g.querySelector("button[aria-label='confirm']"),oe=g.querySelector("button[aria-label='cancel']");oe?.addEventListener("click",R);function ce(){return{render:()=>{const r=document.getElementById("link-buttons-container");r?.querySelector("a[data-role='reset to defaults']")?.addEventListener("click",n=>{n.preventDefault(),ie()}),ae.onclick=()=>{localStorage.clear(),location.reload()};const t=r?.querySelector("a[data-role='copy config']");t?.addEventListener("click",n=>{n.preventDefault(),navigator.clipboard.writeText(re.format());const e=t?.parentElement?.querySelector(".msg");S.displayMsg(e,"your config has been copied to your clipboard"),setTimeout(()=>{e.classList.add("hide")},3e3)})}}}function de({links:r,theme:s,keybinds:t,imageState:n,search:e}){const a=X(r),i=ee(t),o=te(n),c=Q(s,o),l=ne(e,Y()||{name:"","query url":""}),u=se(),m=ce();[c,a,i,o,l,u,m].forEach(U=>U.render())}export{de as default};
